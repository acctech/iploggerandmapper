<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <style>
        div {
            margin: 20px;
        }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAgOlUYGaj39bddODdR8c23O2UuM0hKstQ&map_ids=d7b42814bf968e06&callback=initMap"
            defer>
    </script>
    <style type="text/css">
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 240px;
            width: 50%;
            padding: 10%;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>

<h1>Console Output</h1>
<input id="locationIs" value="academica"/>
<div>
    <button onclick="logMyDownload('http://www.acc.edu.au/journals/academica/ACC-Academica-Vol-1-digital.pdf', document.getElementById('locationIs').value)">Download</button>
</div>
<section>
    <div class="padding3rem maxWidth800">
        <h2>Map of users who have downloaded this journal</h2>

        <p>Reader from: <span id="userDownloadedLocation"></span></p>
        <div id="map"></div>
        <p>ACC Journals have been downloaded
            <span id="counter">this many times</span>
        </p>

    </div>
</section>
</body>

<script src="./script.js"></script>
<script>
    const counterFor = document.getElementById("locationIs").innerText;

    let map;

    function initMap() {

        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 3,
            center: new google.maps.LatLng(-25.274398, 133.775136),
            mapId: "d7b42814bf968e06",
            disableDefaultUI: true,
            useStaticMap: true,
        });

        loadDataIntoCounterAndMap();
    }

    // Loop through the results array and place a marker for each
    // set of coordinates.
    const eqfeed_callback = function (results) {
        // show locations as text
        let userNotificationDiv = document.getElementById("userDownloadedLocation");
        for (let i = 0; i < results.features.length; i++) {
            const coords = results.features[i].geometry.coordinates;
            const latLng = new google.maps.LatLng(coords[1], coords[0]);
            setTimeout(function() {
                userNotificationDiv.innerText = results.features[i].geometry.city;
                new google.maps.Marker({
                    position: latLng,
                    map: map,
                    animation: google.maps.Animation.DROP,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 3,
                    },
                });
            }, i * 2000);
        }
    };

    function loadDataIntoCounterAndMap(){

        getGoogleGeoData(counterFor, function(responseString) {
            let jsonResponse = JSON.parse(responseString);
            eqfeed_callback(jsonResponse)
        });

        getDownloadCounter(counterFor, function(counters){
            // total download counter
            let counterElement = document.getElementById("counter");
            let counter = counters;
            counter.innerHTML = counter;

            let counterSuffix = "time";
            if (counter !== 1){
                counterSuffix = counterSuffix + "s";
            }
            counterElement.textContent = counter + " " + counterSuffix;
            console.log(counterElement.textContent)
        });
    }



</script>

</html>
